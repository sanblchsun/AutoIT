; -----------------------------------------------------------------------------
; SHA1 Hash Machine Code UDF
; Purpose: Provide The Machine Code Version of SHA1 Hash Algorithm In AutoIt
; Author: Ward
; -----------------------------------------------------------------------------

#Include-once
#Include <Memory.au3>

Global $_SHA1_CodeBuffer, $_SHA1_CodeBufferMemory
Global $_SHA1_InitOffset, $_SHA1_InputOffset, $_SHA1_ResultOffset

Global $_HASH_SHA1[4] = [20, 96, '_SHA1_', '_SHA1_']

Func _SHA1_Exit()
	$_SHA1_CodeBuffer = 0
	_MemVirtualFree($_SHA1_CodeBufferMemory, 0, $MEM_RELEASE)
EndFunc

Func _SHA1_Startup()
	If Not IsDllStruct($_SHA1_CodeBuffer) Then
		If @AutoItX64 Then
			Local $Code = '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'
				$Code &= 'NmTRWrw8RlcuZuyM9LrNJjgQiUoB50txBJnMGzH1khYYmBI4iZYYoqjr0uxqiKLMAquw4h9CY8xZPInlHwntUt9Rb6onNKi6YEbj5kjr2xSsL8XQsUtJ7kVpVc50cfWq/8txJNAwJJQc9ZmO91bcUGTnbOOhGdX/qRbLmChwfD3haZxBz6Rz1ZneUP1J3KlqM5Mc1pvQIaQmvrPucPYzQu+M95YXSP7E2YY0PFVKSUMbGRTTlJDm3YkYaWBAISC5UNolkgzWxDr8oTNAklkfIjA4ArQ0EUETIUQG9QmcdbWmENJQU8dknuMjTGU8N/yi4SjsGUo8dTZFFqwrI0b7ntqczGVFCUncGroMShj11DD2QksgSGznzQz3yV78xGKWjUIh3GTBfBiRVklLwkCOlomYDzIB5VrCRrLJEPqa4uMXLBbxOqs6Ge0a4pCm3Sf5ErzCD+sAaaTqKQbhSgyIqrQxz7Ii1VTLTWLeKrw6MVS275ndybDQKY/EO0HN9cg9PlGYp44FXdBWiiXPWwAG1aV8eE8oQDSa46wAZP0G6JR/RjwJ2BRP7kGjIfgxwWkUaAh2pmlCCeBQzP8lBJkPPE7DJiMk+GuyIwyQuwnoktSJavBy2kFfTFbgi7ViMfCp6egnCfjZl1TYIDoqhMsU/KWQSDLR4KnB5HApAcU0IpZa5SX0RSgJ8KWa+sTn1XoBmsGScijnL6DooSQ4CEW6FJK6JAHHLTraWQ0KTCUlp7sR/wne8qiEfJ6gQjH4RBiqEIpCDUo3a+IWmm56YEnsHDVFbRlr9N1VsDYVY2r1BuAg0oI0Avc8K8T1/kWZdhbNk8QcKVTql7/Uzc0yH0PoHWV4wtNGcv/SJoh2FFojLWsDBQxeWFmhoMSnkaW3LBZBTQco9mGWMZlSwd/JzwOyI+7T5H3LXPfqycZ+goYlhUCia5E7T0VF3wnwW9eAygLLeP9LVyB431LPwy0/Ol4IkhiS14G8Id9paco3Q5R0Hg3WCd6IzyzlAtlSelqUNsti7hlQPmlg0FAoMBWeae7SXoL8FmLKjGbThJz8zxlxO6ARiPk26EokKRo8Ens9iTHDxIqeZExelFETSlc/iUTCgRscixw8OhEqLEI+OJKieExaw2Y+m6hujAuiN2SjkNiOopCfWMpvijQ6CThBcg1oAx0TZXzJpZQKDB0sPJttRSQ996EgPERFoez2EyG5DybNqxAsCb7IGNnC0ePEUFxDDCgcOlBAKyyGsgzKq+oRPkJmq9pfUB9mSMi1CmihSLjoZGQ0fCyHlAwmITCQQUJiIeI/wj48w50haFjp6cI4RAXxSv4T/WL/MJhmyRuhGDyWhQKH5TXwCkcsoWsM4G1I7NiuM5jInhnLQSnp7fJXwLlLBWIn7pQRFEJAKzCRkihixjNGNYK4mmcxzgNGHUVCOCQ8rlP1cRM0Rl1UGUdIIzOTvrrVQRRUNZ9r+GxxlRKNkTDIOE6xt+kWAFY0Sk9XccOO6CcG5ozWDNjLBv6TbPrWuSwwc8RABM6Z0hQQbvI8OTQmkENun6ESMC3wBxzqE+I8R7xKRzglLJpbHEr9NschiyFKv1cTMjiVFjZcNOOKSE9t3UqSWe7RVokwPaKyrRVHosyO/JPhLgcsw6mxs+NA2t9U+Uqucu4dg3BTUMtp/6qFx17J3xQ/x0qucUWQlCqn2R+jEDDii25gTUDMn9JsYj44jwXrQpQt3U0raxNABgQsKWaaLf5BNwHNNergZt4GTPs1WMg9i++F1og5OPzrmjOVKWyJSWLazNNi8aqUJjLSStMgiWErTL3UsiRAIurb0bLuElLSkyVIrwxv5anQ5EZy2k/IUsAJr0HxlgP6jQQD7bW5Lwaq00z1WGBYpF+XTAHoUuO2iIuJx0GIGiimM0yjUBJGjAljIOEEQOkB+0igPmjFQhQRwSKJ3kawS8l4WIDvAo0MCjIB8Tq0ftxnDsqlP/C4tGAhBipIg8QBeFteX11BXMt4CO3lw2owbEmJ1fxUzwrMP5pM5H51QChNhcDBhHFYdF/w5j8XTI15'
				$Code &= 'DmS+eJvrDS1JAUBMSIUZ/3RGFN1BifUpyo/G4Tn7dgTt/fe39vGKZ9iG6mqCOIAB7kgp3+iUQAKDDP5Adcgs+s8G4SAw9ugd6nH/rEYqdbqSRyiT8PhIGInXVgjOU99k6ow6IEkF+H92fgePQVjQ4D91R4FmMLLtzED5PuLNyOlE8/noyN98qpBUYCsa+D935MZEQ8A6g8F3XmxBZzJUUAeDJv4BMl5Y3yAww72k0SgpxbJm6DLvkHfrN/D+iGaisHrxNN4BNG0uCgsa6chRkyN9rnhAkKFuWI8d0gQDtSNFZ/SFyQYJq82ePIsU4BkI/ty6YJgRDHZUMrWGhlFeqMcIx+/w8OFj0qSJUN0k/iTyAa3NV7+AkpFWBlPGUzRSy/dC8WEewdP/ROpHxffZ6tIPIdFdDAEJHvgBOEKIDAN2c4o8QbjHSPEaY7iHdQvgKcAx0tR+eCotwqQf9tn2rftAr/bDATC6OFEPhZPPDUDmxwIURpcZBJAWnRTEF6izBekD9sIBwcnzSKuRKppsHFOgiIPiBAF0H8YHwgEahHM4KhrovSUAsENYifaShnrGNw/I9NU4coEsLbgB+gNAawnTFAg3wxIEXqdJde0eXzDGA36NewEfsjfp91ohZscHjefqAkIBqelYoCMQgRIEF0LpURaJD1dZMhIvUiRTgtXRSkVicZIOokromUSzgosjcelAJhtWZJnPBtZAo8H88wqkX17DEETQMqpjhgAA'
		Else
			Local $Code = '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'
				$Code &= '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'
				$Code &= 'h+EDc6TrdBYMX17DV3cQiDAPYrbSDGmNswOZrQh0AwgKKapJCgp19j+S/BBDQIOqX8MAAA=='
		EndIf
		Local $Opcode = _SHA1_CodeDecompress($Code)
		$_SHA1_InitOffset = (StringInStr($Opcode, "89DB") - 3) / 2
		$_SHA1_InputOffset = (StringInStr($Opcode, "87DB") - 3) / 2
		$_SHA1_ResultOffset = (StringInStr($Opcode, "09DB") - 3) / 2
		$Opcode = Binary($Opcode)

		$_SHA1_CodeBufferMemory = _MemVirtualAlloc(0, BinaryLen($Opcode), $MEM_COMMIT, $PAGE_EXECUTE_READWRITE)
		$_SHA1_CodeBuffer = DllStructCreate("byte[" & BinaryLen($Opcode) & "]", $_SHA1_CodeBufferMemory)
		DllStructSetData($_SHA1_CodeBuffer, 1, $Opcode)
		OnAutoItExitRegister("_SHA1_Exit")
	EndIf
EndFunc

Func _SHA1Init()
	If Not IsDllStruct($_SHA1_CodeBuffer) Then _SHA1_Startup()

	Local $Context = DllStructCreate("byte[" & $_HASH_SHA1[1] & "]")
	DllCall("user32.dll", "none", "CallWindowProc", "ptr", DllStructGetPtr($_SHA1_CodeBuffer) + $_SHA1_InitOffset, _
													"ptr", DllStructGetPtr($Context), _
													"int", 0, _
													"int", 0, _
													"int", 0)

	Return $Context
EndFunc

Func _SHA1Input(ByRef $Context, $Data)
	If Not IsDllStruct($_SHA1_CodeBuffer) Then _SHA1_Startup()
	If Not IsDllStruct($Context) Then Return SetError(1, 0, 0)

	$Data = Binary($Data)
	Local $InputLen = BinaryLen($Data)
	Local $Input = DllStructCreate("byte[" & $InputLen & "]")
	DllStructSetData($Input, 1, $Data)
	DllCall("user32.dll", "none", "CallWindowProc", "ptr", DllStructGetPtr($_SHA1_CodeBuffer) + $_SHA1_InputOffset, _
													"ptr", DllStructGetPtr($Context), _
													"ptr", DllStructGetPtr($Input), _
													"uint", $InputLen, _
													"int", 0)
EndFunc

Func _SHA1Result(ByRef $Context)
	If Not IsDllStruct($_SHA1_CodeBuffer) Then _SHA1_Startup()
	If Not IsDllStruct($Context) Then Return SetError(1, 0, "")

	Local $Digest = DllStructCreate("byte[" & $_HASH_SHA1[0] & "]")
	DllCall("user32.dll", "none", "CallWindowProc", "ptr", DllStructGetPtr($_SHA1_CodeBuffer) + $_SHA1_ResultOffset, _
													"ptr", DllStructGetPtr($Context), _
													"ptr", DllStructGetPtr($Digest), _
													"int", 0, _
													"int", 0)
	Return DllStructGetData($Digest, 1)
EndFunc

Func _SHA1($Data)
	Local $Context = _SHA1Init()
	_SHA1Input($Context, $Data)
	Return _SHA1Result($Context)
EndFunc

Func _SHA1_CodeDecompress($Code)
	If @AutoItX64 Then
		Local $Opcode = '0x89C04150535657524889CE4889D7FCB28031DBA4B302E87500000073F631C9E86C000000731D31C0E8630000007324B302FFC1B010E85600000010C073F77544AAEBD3E85600000029D97510E84B000000EB2CACD1E8745711C9EB1D91FFC8C1E008ACE8340000003D007D0000730A80FC05730783F87F7704FFC1FFC141904489C0B301564889FE4829C6F3A45EEB8600D275078A1648FFC610D2C331C9FFC1E8EBFFFFFF11C9E8E4FFFFFF72F2C35A4829D7975F5E5B4158C389D24883EC08C70100000000C64104004883C408C389F64156415541544D89CC555756534C89C34883EC20410FB64104418800418B3183FE010F84AB00000073434863D24D89C54889CE488D3C114839FE0F84A50100000FB62E4883C601E8C601000083ED2B4080FD5077E2480FBEED0FB6042884C00FBED078D3C1E20241885500EB7383FE020F841C01000031C083FE03740F4883C4205B5E5F5D415C415D415EC34863D24D89C54889CE488D3C114839FE0F84CA0000000FB62E4883C601E86401000083ED2B4080FD5077E2480FBEED0FB6042884C078D683E03F410845004983C501E964FFFFFF4863D24D89C54889CE488D3C114839FE0F84E00000000FB62E4883C601E81D01000083ED2B4080FD5077E2480FBEED0FB6042884C00FBED078D389D04D8D7501C1E20483E03041885501C1F804410845004839FE747B0FB62E4883C601E8DD00000083ED2B4080FD5077E6480FBEED0FB6042884C00FBED078D789D0C1E2064D8D6E0183E03C41885601C1F8024108064839FE0F8536FFFFFF41C7042403000000410FB6450041884424044489E84883C42029D85B5E5F5D415C415D415EC34863D24889CE4D89C6488D3C114839FE758541C7042402000000410FB60641884424044489F04883C42029D85B5E5F5D415C415D415EC341C7042401000000410FB6450041884424044489E829D8E998FEFFFF41C7042400000000410FB6450041884424044489E829D8E97CFEFFFF56574889CF4889D64C89C1FCF3A45F5EC3E8500000003EFFFFFF3F3435363738393A3B3C3DFFFFFFFEFFFFFF000102030405060708090A0B0C0D0E0F10111213141516171819FFFFFFFFFFFF1A1B1C1D1E1F202122232425262728292A2B2C2D2E2F3031323358C3'
	Else
		Local $Opcode = '0x89C0608B7424248B7C2428FCB28031DBA4B302E86D00000073F631C9E864000000731C31C0E85B0000007323B30241B010E84F00000010C073F7753FAAEBD4E84D00000029D97510E842000000EB28ACD1E8744D11C9EB1C9148C1E008ACE82C0000003D007D0000730A80FC05730683F87F770241419589E8B3015689FE29C6F3A45EEB8E00D275058A164610D2C331C941E8EEFFFFFF11C9E8E7FFFFFF72F2C32B7C2428897C241C61C389D28B442404C70000000000C6400400C2100089F65557565383EC1C8B6C243C8B5424388B5C24308B7424340FB6450488028B550083FA010F84A1000000733F8B5424388D34338954240C39F30F848B0100000FB63B83C301E8CD0100008D57D580FA5077E50FBED20FB6041084C00FBED078D78B44240CC1E2028810EB6B83FA020F841201000031C083FA03740A83C41C5B5E5F5DC210008B4C24388D3433894C240C39F30F84CD0000000FB63B83C301E8740100008D57D580FA5077E50FBED20FB6041084C078DA8B54240C83E03F080283C2018954240CE96CFFFFFF8B4424388D34338944240C39F30F84D00000000FB63B83C301E82E0100008D57D580FA5077E50FBED20FB6141084D20FBEC278D78B4C240C89C283E230C1FA04C1E004081189CF83C70188410139F374750FB60383C3018844240CE8EC0000000FB654240C83EA2B80FA5077E00FBED20FB6141084D20FBEC278D289C283E23CC1FA02C1E006081739F38D57018954240C8847010F8533FFFFFFC74500030000008B4C240C0FB60188450489C82B44243883C41C5B5E5F5DC210008D34338B7C243839F3758BC74500020000000FB60788450489F82B44243883C41C5B5E5F5DC210008B54240CC74500010000000FB60288450489D02B442438E9B1FEFFFFC7450000000000EB9956578B7C240C8B7424108B4C241485C9742FFC83F9087227F7C7010000007402A449F7C702000000740566A583E90289CAC1E902F3A589D183E103F3A4EB02F3A45F5EC3E8500000003EFFFFFF3F3435363738393A3B3C3DFFFFFFFEFFFFFF000102030405060708090A0B0C0D0E0F10111213141516171819FFFFFFFFFFFF1A1B1C1D1E1F202122232425262728292A2B2C2D2E2F3031323358C3'
	EndIf
	Local $AP_Decompress = (StringInStr($Opcode, "89C0") - 3) / 2
	Local $B64D_Init = (StringInStr($Opcode, "89D2") - 3) / 2
	Local $B64D_DecodeData = (StringInStr($Opcode, "89F6") - 3) / 2
	$Opcode = Binary($Opcode)

	Local $CodeBufferMemory = _MemVirtualAlloc(0, BinaryLen($Opcode), $MEM_COMMIT, $PAGE_EXECUTE_READWRITE)
	Local $CodeBuffer = DllStructCreate("byte[" & BinaryLen($Opcode) & "]", $CodeBufferMemory)
	DllStructSetData($CodeBuffer, 1, $Opcode)

	Local $B64D_State = DllStructCreate("byte[16]")
	Local $Length = StringLen($Code)
	Local $Output = DllStructCreate("byte[" & $Length & "]")

	DllCall("user32.dll", "none", "CallWindowProc", "ptr", DllStructGetPtr($CodeBuffer) + $B64D_Init, _
													"ptr", DllStructGetPtr($B64D_State), _
													"int", 0, _
													"int", 0, _
													"int", 0)

	DllCall("user32.dll", "int", "CallWindowProc", "ptr", DllStructGetPtr($CodeBuffer) + $B64D_DecodeData, _
													"str", $Code, _
													"uint", $Length, _
													"ptr", DllStructGetPtr($Output), _
													"ptr", DllStructGetPtr($B64D_State))

	Local $ResultLen = DllStructGetData(DllStructCreate("uint", DllStructGetPtr($Output)), 1)
	Local $Result = DllStructCreate("byte[" & ($ResultLen + 16) & "]")

	Local $Ret = DllCall("user32.dll", "uint", "CallWindowProc", "ptr", DllStructGetPtr($CodeBuffer) + $AP_Decompress, _
													"ptr", DllStructGetPtr($Output) + 4, _
													"ptr", DllStructGetPtr($Result), _
													"int", 0, _
													"int", 0)


	_MemVirtualFree($CodeBufferMemory, 0, $MEM_RELEASE)
	Return BinaryMid(DllStructGetData($Result, 1), 1, $Ret[0])
EndFunc
